<!doctype html>
<html lang="he" dir="rtl">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Doozy News</title>
    <style>
      :root {
        --bg: #0b1020;
        --text: #e8ecff;
        --muted: #99a6dd;
        --muted-2: #a9b4e7;
        --control-bg: #26346a;
        --control-border: #3a4a8e;
        --control-text: #ffffff;
        --card-bg: #141b34;
        --card-border: #283157;
        --title: #dbe2ff;
        --chip-text: #cdd7ff;
        --footer: #7f8dc6;
        --warn: #ffd27f;
      }
      body[data-theme="jungle-love"] {
        --bg: #f8fbff;
        --text: #143244;
        --muted: #5f7f93;
        --muted-2: #537285;
        --control-bg: #d9f4ff;
        --control-border: #84d8ec;
        --control-text: #0f4259;
        --card-bg: #fff7ef;
        --card-border: #ffc98f;
        --title: #d56b00;
        --chip-text: #0e6678;
        --footer: #74a1b4;
        --warn: #b45b00;
      }
      body[data-theme="jungle-pop"] {
        --bg: #e9fff3;
        --text: #124336;
        --muted: #2f8b75;
        --muted-2: #2a7d93;
        --control-bg: #7ee7f5;
        --control-border: #13b4c8;
        --control-text: #064b54;
        --card-bg: #f3ffe0;
        --card-border: #9adf49;
        --title: #f07d00;
        --chip-text: #0f6a58;
        --footer: #2d9d89;
        --warn: #d85c00;
      }
      body[data-theme="jungle-neon"] {
        --bg: #0f1f1a;
        --text: #e9fff7;
        --muted: #7ce9d2;
        --muted-2: #8ad9ff;
        --control-bg: #123f35;
        --control-border: #2de2b0;
        --control-text: #d9fff3;
        --card-bg: #173128;
        --card-border: #28c89a;
        --title: #ff9b2f;
        --chip-text: #9dfde2;
        --footer: #66d8bc;
        --warn: #ffb14a;
      }
      body[data-theme="light-clean"] {
        --bg: #f6f8fb;
        --text: #16212b;
        --muted: #617080;
        --muted-2: #6d7d8d;
        --control-bg: #ffffff;
        --control-border: #d2dce8;
        --control-text: #1c2a35;
        --card-bg: #ffffff;
        --card-border: #dbe4ef;
        --title: #152433;
        --chip-text: #3a4d60;
        --footer: #7b8da0;
        --warn: #b85b00;
      }
      body[data-theme="sepia-news"] {
        --bg: #f5efdf;
        --text: #33281f;
        --muted: #6c5d4d;
        --muted-2: #786958;
        --control-bg: #efe3cb;
        --control-border: #cbb89b;
        --control-text: #3d2f22;
        --card-bg: #fbf4e7;
        --card-border: #ddc8ab;
        --title: #5b3c1f;
        --chip-text: #5f4a34;
        --footer: #8f7a62;
        --warn: #9b4300;
      }
      body[data-theme="slate-pro"] {
        --bg: #161b23;
        --text: #e5e9f0;
        --muted: #9ba7b7;
        --muted-2: #aab5c3;
        --control-bg: #212a36;
        --control-border: #334154;
        --control-text: #e7edf7;
        --card-bg: #1b2431;
        --card-border: #2f3c4f;
        --title: #e8eefc;
        --chip-text: #c9d4e8;
        --footer: #7e8da3;
        --warn: #ffbf72;
      }
      body { font-family: Arial, sans-serif; margin: 0; background: var(--bg); color: var(--text); }
      .wrap { max-width: 1100px; margin: 0 auto; padding: 10px; }
      h1 { margin: 0 0 4px; text-align:center; font-size: 16px; line-height: 1.15; }
      .sub { color: var(--muted-2); margin-bottom: 6px; text-align:center; }
      .topline { display:flex; flex-direction:column; gap:6px; margin:6px 0; width:100%; }
      .controls-grid { display:grid; grid-template-columns: 1fr 1fr 1fr; gap:6px; width:100%; }
      .mini-select,.refresh-btn { background:var(--control-bg); border:1px solid var(--control-border); color:var(--control-text); border-radius:8px; padding:8px 10px; font-size:15px; line-height:1.15; }
      .meta { color:var(--muted); font-size:11px; text-align:center; min-height:14px; }
      .grid { display:grid; gap:6px; grid-template-columns:1fr; margin-top:6px; }
      .card { background: var(--card-bg); border: 1px solid var(--card-border); border-radius: 10px; padding: 8px 10px; }
      .title { font-size:14px; font-weight:700; line-height:1.2; margin-bottom:4px; }
      .title a { color:var(--title); text-decoration:none; }
      .title a:hover { text-decoration:underline; }
      .row { display:flex; justify-content:space-between; align-items:center; gap:8px; flex-wrap:wrap; }
      .chip { font-size:11px; border:1px solid var(--control-border); color:var(--chip-text); border-radius:999px; padding:2px 8px; }
      .footer-brand { position: fixed; bottom: 6px; left: 0; right: 0; text-align: center; font-size: 10px; color: var(--footer); opacity: .9; pointer-events: none; }
      .warn { color:var(--warn); text-align:center; }
      .reader { position:fixed; inset:0; background:rgba(5,8,18,.92); display:none; z-index:999; }
      .reader.open { display:block; }
      .reader-box { max-width:100%; height:100%; margin:0; padding:0; overflow:auto; }
      .reader-card { background:#0b1020; border:1px solid #283157; border-radius:12px; padding:12px 12px 24px; min-height:100%; margin:8px; }
      .reader-title { font-size:24px; font-weight:700; margin:8px 0 8px; text-align:right; }
      .reader-actions { display:flex; gap:8px; margin-bottom:6px; justify-content:flex-start; }
      .reader-p { color:#dfe5ff; line-height:1.7; margin:0 0 10px; }
      .webview-frame { width:100%; height:78vh; border:0; background:#0b1020; border-radius:8px; }
      .dev-only { display:none; }
    </style>
  </head>
  <body>
    <div class="wrap">
      <h1>Doozy News</h1>

      <div class="topline">
        <div class="controls-grid">
          <select id="sourceSelect" class="mini-select">
            <option value="all">כל האתרים</option>
            <option value="biz">כלכלה</option>
            <option value="general">חדשות כלליות</option>
            <option value="tech">טכנולוגיה</option>
          </select>
          <button id="refreshBtn" class="refresh-btn">רענן חדשות</button>
          <select id="themeSelect" class="mini-select">
            <option value="night">Night</option>
            <option value="jungle-love">Jungle Love · Calm</option>
            <option value="jungle-pop">Jungle Love · Pop</option>
            <option value="jungle-neon">Jungle Love · Neon</option>
            <option value="light-clean">Light Clean</option>
            <option value="sepia-news">Sepia News</option>
            <option value="slate-pro">Slate Pro</option>
          </select>
        </div>
        <div id="backendDev" class="controls-grid dev-only">
          <input id="backendUrl" class="mini-select" placeholder="Backend URL לחילוץ כתבות מלאות" style="text-align:left;direction:ltr;" />
          <button id="saveBackendBtn" class="refresh-btn">שמור Backend</button>
        </div>
        <div id="status" class="meta">טוען...</div>
      </div>

      <div id="newsGrid" class="grid"></div>
    </div>

    <div id="reader" class="reader">
      <div class="reader-box">
        <div class="reader-card">
          <div class="reader-actions">
            <button id="closeReader" class="refresh-btn">סגור</button>
                      </div>
          <div id="readerTitle" class="reader-title">טוען...</div>
          <div id="readerMeta" class="meta"></div>
          <div id="readerBody"></div>
        </div>
      </div>
    </div>

    <div id="footerBrand" class="footer-brand">Doozy Software Inc. · Build 2026-02-20 07:20</div>

    <script>
      const statusEl = document.getElementById('status');
      const gridEl = document.getElementById('newsGrid');
      const readerEl = document.getElementById('reader');
      const readerTitleEl = document.getElementById('readerTitle');
      const readerMetaEl = document.getElementById('readerMeta');
      const readerBodyEl = document.getElementById('readerBody');
      let currentArticleUrl = '';
      const articleMap = new Map();
      const LS_BACKEND = 'doozy_news_backend_v1';
      const LS_THEME = 'doozy_news_theme_v1';
      const DEFAULT_BACKEND = 'https://doozy-news-extractor.onrender.com';

      function applyTheme(theme) {
        const allowed = new Set(['night', 'jungle-love', 'jungle-pop', 'jungle-neon', 'light-clean', 'sepia-news', 'slate-pro']);
        const t = allowed.has(theme) ? theme : 'night';
        if (t === 'night') document.body.removeAttribute('data-theme');
        else document.body.setAttribute('data-theme', t);
        localStorage.setItem(LS_THEME, t);
      }

      function getSavedTheme() {
        const t = localStorage.getItem(LS_THEME) || 'night';
        return t;
      }

      function getBackendBase() {
        return (localStorage.getItem(LS_BACKEND) || DEFAULT_BACKEND || '').trim().replace(/\/$/, '');
      }
      function setBackendBase(v) {
        const clean = String(v || '').trim().replace(/\/$/, '');
        if (clean) localStorage.setItem(LS_BACKEND, clean); else localStorage.removeItem(LS_BACKEND);
      }
      function apiUrl(path) {
        const b = getBackendBase();
        return b ? `${b}${path}` : path;
      }
      async function fetchJson(url) {
        const r = await fetch(url);
        const t = await r.text();
        try { return JSON.parse(t); } catch { return { ok:false, error:'non_json' }; }
      }

      let SOURCES = {
        all: [
          { name: 'כלכליסט', url: 'https://www.calcalist.co.il/GeneralRSS/0,16335,L-8,00.xml' },
          { name: 'גלובס', url: 'https://www.globes.co.il/webservice/rss/rssfeeder.asmx/FeederNode?iID=2' },
          { name: 'דה מרקר', url: 'https://www.themarker.com/cmlink/1.628' },
          { name: 'ynet', url: 'https://www.ynet.co.il/Integration/StoryRss2.xml' },
          { name: 'N12', url: 'https://www.mako.co.il/rss-news?partner=rss' }
        ],
        biz: [
          { name: 'כלכליסט', url: 'https://www.calcalist.co.il/GeneralRSS/0,16335,L-8,00.xml' },
          { name: 'גלובס', url: 'https://www.globes.co.il/webservice/rss/rssfeeder.asmx/FeederNode?iID=2' },
          { name: 'דה מרקר', url: 'https://www.themarker.com/cmlink/1.628' }
        ],
        general: [
          { name: 'ynet', url: 'https://www.ynet.co.il/Integration/StoryRss2.xml' },
          { name: 'N12', url: 'https://www.mako.co.il/rss-news?partner=rss' }
        ],
        tech: [
          { name: 'כלכליסט', url: 'https://www.calcalist.co.il/GeneralRSS/0,16335,L-8,00.xml' },
          { name: 'גלובס', url: 'https://www.globes.co.il/webservice/rss/rssfeeder.asmx/FeederNode?iID=607' }
        ]
      };
      let remoteHideSelectors = [];

      async function loadRemoteConfig() {
        try {
          const src = await fetchJson(apiUrl('/api/sources'));
          if (src?.ok && src?.sources) SOURCES = src.sources;
        } catch {}
        try {
          const rules = await fetchJson(apiUrl('/api/ad-rules'));
          if (rules?.ok && Array.isArray(rules?.rules?.hideSelectors)) {
            remoteHideSelectors = rules.rules.hideSelectors;
          }
        } catch {}
      }

      async function httpText(url) {
        const capHttp = window.CapacitorHttp || window.Capacitor?.Plugins?.CapacitorHttp;
        const isNative = !!window.Capacitor?.isNativePlatform?.();
        if (isNative && capHttp?.get) {
          const r = await capHttp.get({ url, headers: { 'Cache-Control': 'no-cache' } });
          return typeof r.data === 'string' ? r.data : JSON.stringify(r.data);
        }
        const r = await fetch(url);
        return await r.text();
      }


      async function httpTextWithTimeout(url, timeoutMs = 7000) {
        return await Promise.race([
          httpText(url),
          new Promise((_, reject) => setTimeout(() => reject(new Error('timeout')), timeoutMs))
        ]);
      }

      function escapeHtml(str) {
        return String(str || "").replace(/&/g, "&amp;").replace(/</g, "&lt;").replace(/>/g, "&gt;").replace(/"/g, "&quot;").replace(/'/g, "&#39;");
      }

      function parseItems(xmlText, fallbackSource) {
        const doc = new DOMParser().parseFromString(xmlText, 'text/xml');
        const items = [...doc.querySelectorAll('item')].map((it) => {
          const title = (it.querySelector('title')?.textContent || '').trim();
          const link = (it.querySelector('link')?.textContent || '').trim();
          const source = (it.querySelector('source')?.textContent || fallbackSource || '').trim();
          const pubDate = (it.querySelector('pubDate')?.textContent || '').trim();
          const rawDesc = (it.querySelector('description')?.textContent || '').trim();
          const desc = rawDesc.replace(/<[^>]+>/g, ' ').replace(/\s+/g, ' ').trim();
          const ts = Date.parse(pubDate || '') || 0;
          return { title, link, source, pubDate, ts, desc };
        }).filter(x => x.title && x.link);
        return items;
      }

      function uniqByLink(items) {
        const seen = new Set();
        return items.filter((it) => {
          if (seen.has(it.link)) return false;
          seen.add(it.link);
          return true;
        });
      }

      function topicOfItem(item) {
        const src = String(item?.source || '').toLowerCase();
        const title = String(item?.title || '');
        const desc = String(item?.desc || '');
        const text = `${title} ${desc}`.toLowerCase();

        const countHits = (patterns) => patterns.reduce((acc, re) => acc + (re.test(text) ? 1 : 0), 0);

        const techPatterns = [
          /טכנולוג/, /הייטק/, /בינה מלאכותית/, /\bai\b/i, /openai/i, /סייבר/, /שבב/, /chip/i,
          /סטארט[\s-]?אפ/, /startup/i, /ענן/, /cloud/i, /אפל/, /apple/i, /גוגל/, /google/i,
          /מטא/, /meta\b/i, /מיקרוסופט/, /microsoft/i, /nvidia/i, /טסלה/, /tesla/i
        ];

        const bizPatterns = [
          /בורסה/, /מניה/, /מניות/, /שוק ההון/, /מדד/, /נאסד["״]ק/, /דאו ג['׳]ונס/, /s&p/i,
          /ריבית/, /אינפלציה/, /בנק ישראל/, /פד/, /פדרל ריזרב/, /דולר/, /שקל/, /אג["״]ח/,
          /איגרות חוב/, /דוחות/, /תוצאות כספיות/, /רווח/, /הכנסות/, /מיזוג/, /רכישה/, /ipo/i,
          /הנפקה/, /מנכ["״]ל/, /cfo/i
        ];

        let techScore = countHits(techPatterns) * 2;
        let bizScore = countHits(bizPatterns) * 2;

        if (['כלכליסט', 'גלובס', 'דה מרקר', 'themarker', 'calcalist', 'globes'].some(s => src.includes(s.toLowerCase()))) {
          bizScore += 3;
        }

        if (/(שוק|בורסה|מניה|ריבית|אינפלציה|דולר|שקל)/i.test(title)) bizScore += 2;
        if (/(טכנולוג|הייטק|בינה|ai|סייבר|שבב|ענן|סטארט)/i.test(title)) techScore += 2;

        if (techScore === 0 && bizScore === 0) return 'general';
        if (techScore >= bizScore + 1) return 'tech';
        if (bizScore >= techScore + 1) return 'biz';

        // Tie-breaker
        if (/(טכנולוג|הייטק|ai|סייבר|בינה)/i.test(title)) return 'tech';
        if (/(בורסה|מניה|שוק ההון|ריבית|אינפלציה)/i.test(title)) return 'biz';
        return 'general';
      }

      function matchesTopic(item, mode) {
        if (mode === 'all') return true;
        return topicOfItem(item) === mode;
      }

      async function fetchRaw(url) {
        const capHttp = window.CapacitorHttp || window.Capacitor?.Plugins?.CapacitorHttp;
        const isNative = !!window.Capacitor?.isNativePlatform?.();
        if (isNative && capHttp?.get) {
          const r = await capHttp.get({ url, headers: { 'User-Agent': 'Mozilla/5.0' } });
          return typeof r.data === 'string' ? r.data : JSON.stringify(r.data || '');
        }
        const r = await fetch(url);
        return await r.text();
      }

      async function fetchViaReaderProxy(url) {
        const clean = String(url || '').trim();
        if (!clean) return '';
        const noScheme = clean.replace(/^https?:\/\//i, '');
        const proxyUrl = `https://r.jina.ai/http://${noScheme}`;
        try {
          return await fetchRaw(proxyUrl);
        } catch {
          return '';
        }
      }

      function extractReadable(html) {
        const doc = new DOMParser().parseFromString(html, 'text/html');
        [...doc.querySelectorAll('script,style,noscript,iframe,header,footer,nav,aside,.ad,.ads,.advertisement,[role="banner"]')].forEach(el => el.remove());
        const localHide = ['[id*="ad"]','[class*="ad-"]','[class*="advert"]','[class*="banner"]','[class*="popup"]','.paywall','.newsletter','.recommended'];
        const allHide = [...new Set([...localHide, ...remoteHideSelectors])];
        allHide.forEach(sel => { try { doc.querySelectorAll(sel).forEach(el => el.remove()); } catch {} });
        const container = doc.querySelector('article') || doc.querySelector('main') || doc.body;
        const title = (doc.querySelector('meta[property="og:title"]')?.content || doc.querySelector('title')?.textContent || '').trim();
        const paragraphs = [...container.querySelectorAll('p')]
          .map(p => (p.textContent || '').trim())
          .filter(t => t.length > 50)
          .slice(0, 70);
        return { title, paragraphs };
      }


      function parseProxyText(txt) {
        const lines = String(txt || '').split('\n').map(l => l.trim()).filter(Boolean);
        const titleLine = lines.find(l => l.startsWith('Title: ')) || '';
        const title = titleLine.replace(/^Title:\s*/, '').trim();
        const bodyStart = lines.findIndex(l => l.startsWith('Markdown Content:'));
        const bodyLines = bodyStart >= 0 ? lines.slice(bodyStart + 1) : lines;
        const paragraphs = bodyLines
          .join('\n')
          .split(/\n{2,}/)
          .map(p => p.replace(/^#+\s*/, '').trim())
          .filter(p => p.length > 80)
          .slice(0, 80);
        return { title, paragraphs };
      }

      async function openArticle(url, fallbackTitle='', fallbackSnippet='') {
        // In-app browser WebView mode: open original URL directly
        try {
          if (window.cordova) {
            const opts = [
              'location=no',
              'toolbar=yes',
              'hardwareback=no',
              'hidenavigationbuttons=yes',
              'hideurlbar=yes',
              'zoom=yes',
              'closebuttoncaption=סגור'
            ].join(',');
            const ref = cordova.InAppBrowser.open(url, '_blank', opts);

            const isMaariv = (() => {
              try { return /(^|\.)maariv\.co\.il$/i.test(new URL(url).hostname); } catch { return false; }
            })();
            ref.addEventListener('loadstop', () => {
              if (isMaariv) {
                const maarivCss = `
                  (function(){
                    const st=document.createElement('style');
                    st.textContent='iframe[src*="doubleclick"],iframe[src*="googlesyndication"],iframe[src*="googleadservices"],iframe[src*="taboola"],iframe[src*="outbrain"],ins.adsbygoogle,.adsbygoogle,[id^="google_ads"],[id*="taboola"],[class*="taboola"],[class*="outbrain"],[data-ad-slot],[data-google-query-id],.ad,.ads,.advertisement{display:none !important;visibility:hidden !important;max-height:0 !important;overflow:hidden !important;}';
                    document.head && document.head.appendChild(st);
                  })();`;
                ref.executeScript({ code: maarivCss });
                return;
              }
              const js = `
                (function(){
                  const sels=[
                    'iframe[src*="doubleclick"]','iframe[src*="googlesyndication"]','iframe[src*="googleadservices"]',
                    'iframe[src*="taboola"]','iframe[src*="outbrain"]','ins.adsbygoogle','.adsbygoogle',
                    '[id^="google_ads"]','[id*="taboola"]','[class*="taboola"]','[class*="outbrain"]',
                    '[data-ad-slot]','[data-google-query-id]'
                  ];
                  function killAds(){
                    try { sels.forEach(s=>document.querySelectorAll(s).forEach(el=>el.remove())); } catch(e) {}
                  }
                  killAds();
                  let t;
                  const mo=new MutationObserver(()=>{ clearTimeout(t); t=setTimeout(killAds, 120); });
                  mo.observe(document.documentElement,{childList:true,subtree:true});
                  setTimeout(()=>mo.disconnect(),12000);
                })();`;
              ref.executeScript({ code: js });
            });
            return;
          }
        } catch {}
        window.open(url, '_blank');
      }

      async function loadNews(force = false) {
        const mode = document.getElementById('sourceSelect').value;
        const feeds = SOURCES.all || [];
        const prevH = gridEl.offsetHeight;
        if (prevH > 0) gridEl.style.minHeight = `${prevH}px`;
        statusEl.textContent = 'טוען כותרות...';

        const requests = feeds.map(async (f) => {
          const bust = force ? (f.url.includes('?') ? '&' : '?') + 't=' + Date.now() : '';
          const xml = await httpTextWithTimeout(f.url + bust, 7000);
          return parseItems(xml, f.name);
        });
        const settled = await Promise.allSettled(requests);
        const all = [];
        let okFeeds = 0;
        for (const r of settled) {
          if (r.status === 'fulfilled') {
            okFeeds += 1;
            all.push(...(r.value || []));
          }
        }

        const rows = uniqByLink(all).sort((a,b) => b.ts - a.ts);
        const filteredRows = rows.filter((it) => matchesTopic(it, mode)).slice(0, 60);
        gridEl.innerHTML = '';

        if (!filteredRows.length) {
          gridEl.innerHTML = '<div class="card warn">לא הצלחתי למשוך כותרות כרגע. ייתכן שחלק מהמקורות איטיים/חסומים כרגע. נסה שוב בעוד דקה.</div>';
          statusEl.textContent = 'אין נתונים כרגע';
          gridEl.style.minHeight = '';
          return;
        }

        const frag = document.createDocumentFragment();
        articleMap.clear();
        for (const n of filteredRows) {
          const div = document.createElement('div');
          div.className = 'card';
          const when = n.ts ? new Date(n.ts).toLocaleString('he-IL', { day:'2-digit', month:'2-digit', hour:'2-digit', minute:'2-digit' }) : (n.pubDate || '');
          articleMap.set(n.link, n);
          div.innerHTML = `
            <div class="title open-article" data-url="${n.link.replace(/"/g, "&quot;")}" data-title="${escapeHtml(n.title)}" style="cursor:pointer;">${escapeHtml(n.title)}</div>
            <div class="row">
              <div class="meta">${when}</div>
              <div class="chip">${escapeHtml(n.source || 'מקור לא ידוע')}</div>
            </div>
          `;
          frag.appendChild(div);
        }
        gridEl.appendChild(frag);
        statusEl.textContent = `נטענו ${filteredRows.length} כותרות (${okFeeds}/${feeds.length} מקורות) · סינון: ${mode}`;
        if (!filteredRows.length) statusEl.textContent = `אין כותרות כרגע לסינון "${mode}" (${okFeeds}/${feeds.length} מקורות הצליחו)`;
        requestAnimationFrame(() => { gridEl.style.minHeight = ''; });
      }

      document.getElementById('refreshBtn').addEventListener('click', () => loadNews(true));
      document.getElementById('sourceSelect').addEventListener('change', () => loadNews(true));
      document.getElementById('themeSelect').addEventListener('change', (e) => applyTheme(e.target.value));
      document.addEventListener('click', (e) => {
        const a = e.target.closest('a');
        if (a) { e.preventDefault(); e.stopPropagation(); }
      }, true);

      gridEl.addEventListener('click', (e) => {
        const anyA = e.target.closest('a');
        if (anyA) e.preventDefault();
      }, true);
      gridEl.addEventListener('click', (e) => {
        const a = e.target.closest('.open-article');
        if (!a) return;
        e.preventDefault();
        const u = a.getAttribute('data-url') || '';
        const item = articleMap.get(u);
        openArticle(u, a.getAttribute('data-title') || a.textContent || '', item?.desc || '');
      });
      document.getElementById('closeReader').addEventListener('click', () => { readerEl.classList.remove('open'); });
      const themeSelect = document.getElementById('themeSelect');
      const initialTheme = getSavedTheme();
      applyTheme(initialTheme);
      if (themeSelect) themeSelect.value = initialTheme;

      const devMode = new URLSearchParams(location.search).get('dev') === '1';
      const backendDev = document.getElementById('backendDev');
      const backendInput = document.getElementById('backendUrl');
      const saveBackendBtn = document.getElementById('saveBackendBtn');
      if (devMode && backendDev) backendDev.style.display = 'grid';
      if (backendInput) backendInput.value = getBackendBase();
      if (saveBackendBtn) saveBackendBtn.addEventListener('click', () => {
        setBackendBase(backendInput.value || '');
        statusEl.textContent = getBackendBase() ? 'Backend נשמר לחילוץ כתבות מלאות' : 'Backend הוסר';
      });

      (async () => {
        await loadRemoteConfig();
        await loadNews();
      })();
      setInterval(async () => { await loadRemoteConfig(); await loadNews(false); }, 5 * 60 * 1000);
    </script>
  </body>
</html>
